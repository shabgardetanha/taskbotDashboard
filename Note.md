# ۲. لاگین کن (فقط یک بار)

`supabase login`

# ۳. پروژه رو لینک کن (داخل پوشه پروژه taskbot-dashboard باش)

`supabase link --project-ref qkiexuabetcejvbpztje`

`supabase/migrations/20251128120000_create_task_system.sql`

```sql
-- فعال‌سازی افزونه‌های لازم
create extension if not exists "uuid-ossp";

-- جدول کاربران تلگرام
create table profiles (
  id uuid primary key default uuid_generate_v4(),
  telegram_id bigint unique not null,
  username text,
  full_name text,
  created_at timestamp with time zone default now(),
  updated_at timestamp with time zone default now()
);

-- جدول وظایف
create table tasks (
  id bigint generated by default as identity primary key,
  title text not null,
  description text,
  status text check (status in ('todo', 'inprogress', 'done')) default 'todo',
  priority text check (priority in ('low', 'medium', 'high', 'urgent')) default 'medium',
  assignee_id uuid references profiles(id) on delete cascade,
  created_at timestamp with time zone default now(),
  updated_at timestamp with time zone default now()
);

-- ایندکس برای سرعت
create index idx_tasks_status on tasks(status);
create index idx_tasks_assignee on tasks(assignee_id);

-- فعال‌سازی Realtime
alter publication "supabase_realtime" add table profiles, tasks;

-- RLS (امنیت) — فقط صاحب وظیفه بتونه ویرایش کنه
alter table profiles enable row level security;
alter table tasks enable row level security;

create policy "users can view own profile" on profiles
  for select using (auth.uid() = id or telegram_id = (select telegram_id from profiles where id = auth.uid()));

create policy "users can manage own tasks" on tasks
  for all using (assignee_id = (select id from profiles where telegram_id = (select auth.uid()::text::bigint)));
```

`supabase db push`

https://api.telegram.org/bot8583059954:AAE9DmTwfIutLihdFEIQCZG0O-mFuSYW_Pk/setWebhook?url=https://eloquent-quokka-7cf0d2.netlify.app//.netlify/functions/telegram

https://api.telegram.org/bot8583059954:AAE9DmTwfIutLihdFEIQCZG0O-mFuSYW_Pk/getWebhookInfo
